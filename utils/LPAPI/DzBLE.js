var _0x29b7=['charCodeAt','stopBluetoothDevicesDiscovery','onBLECharacteristicValueChange','writeBLECharacteristicValue','初始化蓝牙适配器成功！','properties','toString','characteristics','map','push','连接打印机失败','1F770088','split','slice','write','log','buffer','toUpperCase','android','hideToast','^[0-9]+','charAt','连接蓝牙设备失败','loading','substring','connected','platform','deviceId','match','openBluetoothAdapter','length','read','showToast','notify','exports','devices','onBLEConnectionStateChange','getSystemInfo','splice','substr'];var _0x32f7=function(_0x29b7c4,_0x32f757){_0x29b7c4=_0x29b7c4-0x0;var _0x5d9659=_0x29b7[_0x29b7c4];return _0x5d9659;};const sDeTongCheckSum='5682904137';const maxSendDataLength=0xb4;const sendDataWaitTime=0x1c;var connectedDeviceId='';var connectedDevicServiceId='';var writeCharacteristicsId='';var readCharacteristicsId='';var notifyCharacteristicsId='';var interval=null;var printList=[];var supportPrefixKeys=[];var printHex='';var sDidSendDataHandler;var sDidSendHexHandler;module[_0x32f7('0x22')]={'setSupportPrefixs':setSupportPrefixs,'initBLE':initBLE,'startScanPeripherals':startScanPeripherals,'stopScanPeripherals':stopScanPeripherals,'connectPeripheral':connectPeripheral,'disconnectPeripheral':disconnectPeripheral,'scanedPeripherals':scanedPeripherals,'sendData':sendData};function setSupportPrefixs(_0x17271c){supportPrefixKeys=_0x17271c;}function initBLE(_0x356137){wx[_0x32f7('0x1d')]({'success':function(_0x174ac3){console[_0x32f7('0xf')](_0x32f7('0x4'));startScanPeripherals(_0x356137);wx['onBluetoothAdapterStateChange'](function(_0x43a043){});}});}function startScanPeripherals(_0x29a90e){wx['startBluetoothDevicesDiscovery']({'success':function(_0x388814){setTimeout(function(){scanedPeripherals(function(_0x5a8494){_0x29a90e(_0x5a8494);});},0x5dc);}});}function stopScanPeripherals(){wx[_0x32f7('0x1')]({'success':function(_0x1bd167){}});}function connectPeripheral(_0x5a33f9,_0x525d09,_0x3757a4){wx[_0x32f7('0x24')](function(_0x2f5221){if(_0x2f5221[_0x32f7('0x1b')]!=connectedDeviceId){return;}if(!_0x2f5221[_0x32f7('0x19')]){if(_0x3757a4){_0x3757a4();}}});stopScanPeripherals();wx['createBLEConnection']({'deviceId':_0x5a33f9,'success':function(_0x34e5fc){connectedDeviceId=_0x5a33f9;wx['getBLEDeviceServices']({'deviceId':connectedDeviceId,'success':function(_0x17b651){var _0x1ad37d=_0x17b651['services'];for(var _0x1d6809=0x0;_0x1d6809<_0x1ad37d['length'];_0x1d6809++){var _0xd9d06c=_0x17b651['services'][_0x1d6809]['uuid'];if(_0xd9d06c!='F000FFC0-0451-4000-B000-000000000000'&&_0xd9d06c!='000018F0-0000-1000-8000-00805F9B34FB'&&_0xd9d06c!='00001800-0000-1000-8000-00805F9B34FB'&&_0xd9d06c!='0000180A-0000-1000-8000-00805F9B34FB'&&_0xd9d06c!='00001801-0000-1000-8000-00805F9B34FB'){connectedDevicServiceId=_0xd9d06c;break;}}wx['getBLEDeviceCharacteristics']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'success':function(_0x4e8570){for(var _0x1bea51=0x0;_0x1bea51<_0x4e8570[_0x32f7('0x7')]['length'];_0x1bea51++){if(_0x4e8570[_0x32f7('0x7')][_0x1bea51][_0x32f7('0x5')][_0x32f7('0x21')]){notifyCharacteristicsId=_0x4e8570[_0x32f7('0x7')][_0x1bea51]['uuid'];}if(_0x4e8570['characteristics'][_0x1bea51][_0x32f7('0x5')][_0x32f7('0xe')]){writeCharacteristicsId=_0x4e8570[_0x32f7('0x7')][_0x1bea51]['uuid'];}if(_0x4e8570['characteristics'][_0x1bea51][_0x32f7('0x5')][_0x32f7('0x1f')]){readCharacteristicsId=_0x4e8570[_0x32f7('0x7')][_0x1bea51]['uuid'];}}wx['notifyBLECharacteristicValueChange']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':notifyCharacteristicsId,'state':!![],'success':function(_0x2c0113){}});wx[_0x32f7('0x25')]({'success':function(_0x137d72){if(_0x137d72['platform']=='ios'){cheakDeviceType(!![]);}else if(_0x137d72[_0x32f7('0x1a')]==_0x32f7('0x12')){cheakDeviceType(![]);wx['setBLEMTU']({'deviceId':connectedDeviceId,'mtu':0x200});}_0x525d09();}});},'fail':function(){console[_0x32f7('0xf')]('获取特征值失败');},'complete':function(){}});}});},'fail':function(_0x4d9ee9){console[_0x32f7('0xf')](_0x32f7('0x16'),_0x4d9ee9['errCode'],_0x4d9ee9['errMsg']);wx[_0x32f7('0x20')]({'title':_0x32f7('0xa'),'icon':'','image':'','duration':0x7d0,'mask':!![],'success':function(_0x4e76b5){},'fail':function(_0x12d298){},'complete':function(_0xdb3c4){}});},'complete':function(){}});}function disconnectPeripheral(){wx['closeBLEConnection']({'deviceId':connectedDeviceId,'success':function(_0x216104){}});}function scanedPeripherals(_0x3f9596){wx['getBluetoothDevices']({'success':function(_0x44b3bc){var _0x5f05ea=new Array();for(var _0x173aba=0x0;_0x173aba<_0x44b3bc[_0x32f7('0x23')][_0x32f7('0x1e')];_0x173aba++){var _0x17e8f9=_0x44b3bc[_0x32f7('0x23')][_0x173aba]['name'];if(isMyPrinterForName(_0x17e8f9)){_0x5f05ea['push'](_0x44b3bc['devices'][_0x173aba]);}}_0x3f9596(_0x5f05ea);}});}function sendData(_0x233a8f,_0x50cac2){if(printList==null){printList=new Array();}if(_0x233a8f!=null){printList[_0x32f7('0x9')](_0x233a8f);if(printList[_0x32f7('0x1e')]>0x0){var _0x194666=printList[0x0];if(_0x194666['length']>0x0){wx[_0x32f7('0x20')]({'title':'正在发送数据','icon':_0x32f7('0x17'),'image':'','duration':0x2710,'mask':!![],'success':function(_0x76472c){},'fail':function(_0x314750){},'complete':function(_0x556367){}});sDidSendDataHandler=_0x50cac2;postDatas();}else{clearInterval(interval);printList['splice'](0x0,0x1);wx[_0x32f7('0x13')]();_0x50cac2();}}}}function postDatas(){cheakBufferSize(_0x32f7('0xb'),function(_0x85b2ef){if(_0x85b2ef<=0x3e8){postDatas();}else{printHex='';var _0x5cee51=printList[0x0];for(;_0x5cee51[_0x32f7('0x1e')]>0x0;_0x5cee51[_0x32f7('0x26')](0x0,0x1)){var _0xa595e1=_0x5cee51[0x0];if(printHex[_0x32f7('0x1e')]+_0xa595e1['length']>=_0x85b2ef){break;}printHex+=_0xa595e1;}postHexValue(function(){if(_0x5cee51['length']>0x0){postDatas();}else{printList[_0x32f7('0x26')](0x0,0x1);wx['hideToast']();sDidSendDataHandler();}});}});}function postHexValue(_0x2ff323){sDidSendHexHandler=_0x2ff323;postHex();}function postHex(){if(printHex['length']>0x0){interval=setTimeout(function(){var _0x51c83a;if(printHex[_0x32f7('0x1e')]>maxSendDataLength){_0x51c83a=printHex[_0x32f7('0x27')](0x0,maxSendDataLength);printHex=printHex['substring'](maxSendDataLength);}else{_0x51c83a=printHex;printHex='';}var _0x59a215=new Uint8Array(_0x51c83a[_0x32f7('0x1c')](/[\da-f]{2}/gi)['map'](function(_0x3e4202){return parseInt(_0x3e4202,0x10);}));wx['writeBLECharacteristicValue']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x59a215['buffer'],'success':function(_0x438f85){}});postHex();},sendDataWaitTime);}else{sDidSendHexHandler();}}function cheakDeviceType(_0x418519){var _0x4ddffc='1F78010288';if(_0x418519){_0x4ddffc='1F78010388';}var _0x5d0012=new Uint8Array(_0x4ddffc[_0x32f7('0x1c')](/[\da-f]{2}/gi)['map'](function(_0x611852){return parseInt(_0x611852,0x10);}));wx[_0x32f7('0x3')]({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x5d0012['buffer'],'success':function(_0x1ed938){}});}function cheakBufferSize(_0x7ac6e9,_0x136e50){var _0x2c7642=new Uint8Array(_0x7ac6e9[_0x32f7('0x1c')](/[\da-f]{2}/gi)[_0x32f7('0x8')](function(_0x2ffe08){return parseInt(_0x2ffe08,0x10);}));wx[_0x32f7('0x2')](function(_0x2f6033){if(_0x2f6033[_0x32f7('0x1b')]!=connectedDeviceId){return;}var _0x4b36b8=ab2hex(_0x2f6033['value']);var _0x191785=0x0;var _0x4c6f8b=_0x4b36b8[0x3];if(_0x4c6f8b>=0xc0){var _0x54bec9=_0x4b36b8[0x3];var _0x922fad=_0x4b36b8[0x4];_0x191785=(_0x54bec9<<0x8)+_0x922fad;}else{_0x191785=_0x4c6f8b;}_0x136e50(_0x191785*0x1f4);});wx['writeBLECharacteristicValue']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x2c7642[_0x32f7('0x10')],'success':function(_0x1c69c5){}});}function ab2hex(_0x43c51e){var _0xfd3c47=Array['prototype']['map']['call'](new Uint8Array(_0x43c51e),function(_0x3019fd){return('00'+_0x3019fd[_0x32f7('0x6')](0x10))[_0x32f7('0xd')](-0x2);});return _0xfd3c47['join'](',');}function isMyPrinterForName(_0x240500){var _0x5263ea=_0x240500['toUpperCase']();var _0x566cab=_0x5263ea[_0x32f7('0xc')]('-');if(_0x566cab['length']>0x1){_0x5263ea=_0x566cab[_0x566cab[_0x32f7('0x1e')]-0x1];if(_0x5263ea['length']<0x8){return![];}}else{return![];}var _0x59858c=new RegExp('^[A-Z]{0,2}[0-9]{4,5}[0-9A-Z]{2,3}[0-9]{2}$','g');if(!_0x59858c['exec'](_0x5263ea)){return![];}var _0x470f01=new RegExp(_0x32f7('0x14'),'g');var _0x5fb085=_0x470f01['exec'](_0x5263ea);var _0x4dbdd8='';var _0xafe2d3=0x0;if(_0x5263ea['charAt'](0x1)<'0'||_0x5263ea['charAt'](0x1)>'9'){_0x4dbdd8=_0x5263ea['substring'](0x0,0x2);_0x5263ea=_0x5263ea['substring'](0x2,_0x5263ea[_0x32f7('0x1e')]);_0xafe2d3+=_0x4dbdd8['charCodeAt'](0x0)*0xb;_0xafe2d3+=_0x4dbdd8['charCodeAt'](0x1)*0xc;}else if(_0x5263ea['charAt'](0x0)<'0'||_0x5263ea['charAt'](0x0)>'9'){_0x4dbdd8=_0x5263ea[_0x32f7('0x18')](0x0,0x1);_0x5263ea=_0x5263ea[_0x32f7('0x18')](0x1,_0x5263ea['length']);_0xafe2d3+=_0x4dbdd8['charCodeAt'](0x0)*0x11;}if(_0x4dbdd8['toUpperCase']()=='D'||_0x4dbdd8[_0x32f7('0x11')]()=='O'){}else if(_0x5263ea['length']<0x8){return![];}else{if(supportPrefixKeys['length']>0x0){for(var _0x574218=0x0;_0x574218<supportPrefixKeys['length'];_0x574218++){var _0x54c727=supportPrefixKeys[_0x574218];if(_0x54c727['length']>0x0){var _0xf2614b=_0x5263ea['substring'](0x0,_0x54c727[_0x32f7('0x1e')]);if(_0xf2614b[_0x32f7('0x11')]()==_0x54c727[_0x32f7('0x11')]()){break;}}else{return![];}}}}if(!_0x5fb085||_0x5263ea['length']>=0x9||_0x5263ea['charAt'](0x3)!='0'){if(_0x5fb085){_0xafe2d3+=(_0x5263ea['charAt'](0x0)-'0')*0x2;_0xafe2d3+=(_0x5263ea[_0x32f7('0x15')](0x1)-'0')*0x3;_0xafe2d3+=(_0x5263ea['charAt'](0x2)-'0')*0x5;for(var _0x574218=0x4;_0x574218<_0x5263ea['length'];++_0x574218){_0xafe2d3+=(_0x5263ea[_0x32f7('0x15')](_0x574218)-'0')*((_0x574218&0x1)==0x0?0x7:0x9);}}else{_0xafe2d3+=_0x5263ea[_0x32f7('0x15')](0x0)*0x2;_0xafe2d3+=_0x5263ea['charAt'](0x1)*0x3;_0xafe2d3+=_0x5263ea['charAt'](0x2)*0x5;for(var _0x574218=0x4;_0x574218<_0x5263ea[_0x32f7('0x1e')];++_0x574218){_0xafe2d3+=_0x5263ea[_0x32f7('0x0')](_0x574218)*((_0x574218&0x1)==0x0?0x7:0x9);}}var _0x5e2268=_0xafe2d3%0xa;if(sDeTongCheckSum[_0x32f7('0x15')](_0x5e2268)!=_0x5263ea[_0x32f7('0x15')](0x3)){return![];}}return!![];}