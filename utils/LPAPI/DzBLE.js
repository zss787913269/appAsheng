var _0x49e8=['uuid','split','getBLEDeviceServices','platform','5682904137','hideToast','name','android','onBluetoothAdapterStateChange','000018F0-0000-1000-8000-00805F9B34FB','exec','devices','charCodeAt','getBLEDeviceCharacteristics','1F78010388','closeBLEConnection','writeBLECharacteristicValue','^[0-9]+','^[A-Z]{0,2}[0-9]{4,5}[0-9A-Z]{2,3}[0-9]{2}$','log','startBluetoothDevicesDiscovery','deviceId','toUpperCase','showToast','length','value','errCode','setBLEMTU','stopBluetoothDevicesDiscovery','characteristics','match','获取特征值失败','初始化蓝牙适配器成功！','buffer','00001800-0000-1000-8000-00805F9B34FB','charAt','call','splice','连接蓝牙设备失败','substring','onBLECharacteristicValueChange','properties'];var _0x4acc=function(_0x49e849,_0x4acc63){_0x49e849=_0x49e849-0x0;var _0x2f488a=_0x49e8[_0x49e849];return _0x2f488a;};const sDeTongCheckSum=_0x4acc('0x4');const maxSendDataLength=0xb4;const sendDataWaitTime=0x1c;var connectedDeviceId='';var connectedDevicServiceId='';var writeCharacteristicsId='';var readCharacteristicsId='';var notifyCharacteristicsId='';var interval=null;var printList=[];var supportPrefixKeys=[];var printHex='';var sDidSendDataHandler;var sDidSendHexHandler;module['exports']={'setSupportPrefixs':setSupportPrefixs,'initBLE':initBLE,'startScanPeripherals':startScanPeripherals,'stopScanPeripherals':stopScanPeripherals,'connectPeripheral':connectPeripheral,'disconnectPeripheral':disconnectPeripheral,'scanedPeripherals':scanedPeripherals,'sendData':sendData};function setSupportPrefixs(_0x1146b5){supportPrefixKeys=_0x1146b5;}function initBLE(_0x139c54){wx['openBluetoothAdapter']({'success':function(_0x2577ce){console['log'](_0x4acc('0x20'));startScanPeripherals(_0x139c54);wx[_0x4acc('0x8')](function(_0x594ae0){});}});}function startScanPeripherals(_0x4a8327){wx[_0x4acc('0x14')]({'success':function(_0x117417){setTimeout(function(){scanedPeripherals(function(_0x5d963f){_0x4a8327(_0x5d963f);});},0x5dc);}});}function stopScanPeripherals(){wx[_0x4acc('0x1c')]({'success':function(_0x5e5582){}});}function connectPeripheral(_0x5dcbde,_0x460eb5,_0x5ec52f){wx['onBLEConnectionStateChange'](function(_0x19b2bc){if(_0x19b2bc[_0x4acc('0x15')]!=connectedDeviceId){return;}if(!_0x19b2bc['connected']){if(_0x5ec52f){_0x5ec52f();}}});stopScanPeripherals();wx['createBLEConnection']({'deviceId':_0x5dcbde,'success':function(_0x764a46){connectedDeviceId=_0x5dcbde;wx[_0x4acc('0x2')]({'deviceId':connectedDeviceId,'success':function(_0x41fa4a){var _0xa626a9=_0x41fa4a['services'];for(var _0x17973a=0x0;_0x17973a<_0xa626a9['length'];_0x17973a++){var _0x1ea005=_0x41fa4a['services'][_0x17973a][_0x4acc('0x0')];if(_0x1ea005!='F000FFC0-0451-4000-B000-000000000000'&&_0x1ea005!=_0x4acc('0x9')&&_0x1ea005!=_0x4acc('0x22')&&_0x1ea005!='0000180A-0000-1000-8000-00805F9B34FB'&&_0x1ea005!='00001801-0000-1000-8000-00805F9B34FB'){connectedDevicServiceId=_0x1ea005;break;}}wx[_0x4acc('0xd')]({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'success':function(_0x39c276){for(var _0x2c9b22=0x0;_0x2c9b22<_0x39c276[_0x4acc('0x1d')]['length'];_0x2c9b22++){if(_0x39c276['characteristics'][_0x2c9b22][_0x4acc('0x29')]['notify']){notifyCharacteristicsId=_0x39c276['characteristics'][_0x2c9b22][_0x4acc('0x0')];}if(_0x39c276['characteristics'][_0x2c9b22]['properties']['write']){writeCharacteristicsId=_0x39c276[_0x4acc('0x1d')][_0x2c9b22][_0x4acc('0x0')];}if(_0x39c276[_0x4acc('0x1d')][_0x2c9b22]['properties']['read']){readCharacteristicsId=_0x39c276[_0x4acc('0x1d')][_0x2c9b22][_0x4acc('0x0')];}}wx['notifyBLECharacteristicValueChange']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':notifyCharacteristicsId,'state':!![],'success':function(_0x3acc64){}});wx['getSystemInfo']({'success':function(_0x114fcf){if(_0x114fcf['platform']=='ios'){cheakDeviceType(!![]);}else if(_0x114fcf[_0x4acc('0x3')]==_0x4acc('0x7')){cheakDeviceType(![]);wx[_0x4acc('0x1b')]({'deviceId':connectedDeviceId,'mtu':0x200});}_0x460eb5();}});},'fail':function(){console[_0x4acc('0x13')](_0x4acc('0x1f'));},'complete':function(){}});}});},'fail':function(_0x2fbbe6){console['log'](_0x4acc('0x26'),_0x2fbbe6[_0x4acc('0x1a')],_0x2fbbe6['errMsg']);wx[_0x4acc('0x17')]({'title':'连接打印机失败','icon':'','image':'','duration':0x7d0,'mask':!![],'success':function(_0x16d987){},'fail':function(_0xff0ffc){},'complete':function(_0x3a36c2){}});},'complete':function(){}});}function disconnectPeripheral(){wx[_0x4acc('0xf')]({'deviceId':connectedDeviceId,'success':function(_0x2c78ef){}});}function scanedPeripherals(_0x587424){wx['getBluetoothDevices']({'success':function(_0x6fc33e){var _0x3c0677=new Array();for(var _0x52f04d=0x0;_0x52f04d<_0x6fc33e[_0x4acc('0xb')]['length'];_0x52f04d++){var _0x550835=_0x6fc33e[_0x4acc('0xb')][_0x52f04d][_0x4acc('0x6')];if(isMyPrinterForName(_0x550835)){_0x3c0677['push'](_0x6fc33e['devices'][_0x52f04d]);}}_0x587424(_0x3c0677);}});}function sendData(_0xa48edf,_0x2dad19){if(printList==null){printList=new Array();}if(_0xa48edf!=null){printList['push'](_0xa48edf);if(printList['length']>0x0){var _0x5bd896=printList[0x0];if(_0x5bd896[_0x4acc('0x18')]>0x0){wx[_0x4acc('0x17')]({'title':'正在发送数据','icon':'loading','image':'','duration':0x2710,'mask':!![],'success':function(_0x31123e){},'fail':function(_0x389797){},'complete':function(_0x11df55){}});sDidSendDataHandler=_0x2dad19;postDatas();}else{clearInterval(interval);printList[_0x4acc('0x25')](0x0,0x1);wx[_0x4acc('0x5')]();_0x2dad19();}}}}function postDatas(){cheakBufferSize('1F770088',function(_0x41475a){if(_0x41475a<=0xbb8){setTimeout(()=>{postDatas();},0x32);}else{printHex='';var _0x25cb46=printList[0x0];for(;_0x25cb46['length']>0x0;_0x25cb46['splice'](0x0,0x1)){var _0x537075=_0x25cb46[0x0];if(printHex['length']+_0x537075[_0x4acc('0x18')]>=_0x41475a){break;}printHex+=_0x537075;}postHexValue(function(){if(_0x25cb46[_0x4acc('0x18')]>0x0){postDatas();}else{printList[_0x4acc('0x25')](0x0,0x1);wx[_0x4acc('0x5')]();sDidSendDataHandler();}});}});}function postHexValue(_0x57b403){sDidSendHexHandler=_0x57b403;postHex();}function postHex(){if(printHex['length']>0x0){interval=setTimeout(function(){var _0x40038a;if(printHex[_0x4acc('0x18')]>maxSendDataLength){_0x40038a=printHex['substr'](0x0,maxSendDataLength);printHex=printHex['substring'](maxSendDataLength);}else{_0x40038a=printHex;printHex='';}var _0x6699f1=new Uint8Array(_0x40038a['match'](/[\da-f]{2}/gi)['map'](function(_0x3d2762){return parseInt(_0x3d2762,0x10);}));wx[_0x4acc('0x10')]({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x6699f1[_0x4acc('0x21')],'success':function(_0x3d9dd6){}});postHex();},sendDataWaitTime);}else{sDidSendHexHandler();}}function cheakDeviceType(_0x322a4b){var _0xb17fe0='1F78010288';if(_0x322a4b){_0xb17fe0=_0x4acc('0xe');}var _0x723e83=new Uint8Array(_0xb17fe0[_0x4acc('0x1e')](/[\da-f]{2}/gi)['map'](function(_0x322af0){return parseInt(_0x322af0,0x10);}));wx[_0x4acc('0x10')]({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x723e83['buffer'],'success':function(_0x4ba6e2){}});}function cheakBufferSize(_0x2e70c4,_0xb491){var _0x54a80f=new Uint8Array(_0x2e70c4[_0x4acc('0x1e')](/[\da-f]{2}/gi)['map'](function(_0x30aecf){return parseInt(_0x30aecf,0x10);}));wx[_0x4acc('0x28')](function(_0xb0fac6){if(_0xb0fac6[_0x4acc('0x15')]!=connectedDeviceId){return;}var _0x58d7d4=ab2hex(_0xb0fac6[_0x4acc('0x19')]);var _0x7bfa50=0x0;var _0x1a36ba=_0x58d7d4[0x3];if(_0x1a36ba>=0xc0){var _0x40ab1f=_0x58d7d4[0x3];var _0x55c87e=_0x58d7d4[0x4];_0x7bfa50=(_0x40ab1f<<0x8)+_0x55c87e;}else{_0x7bfa50=_0x1a36ba;}_0xb491(_0x7bfa50*0x1f4);});wx['writeBLECharacteristicValue']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x54a80f['buffer'],'success':function(_0x2f77fb){}});}function ab2hex(_0x2a4f70){var _0x33e5c9=Array['prototype']['map'][_0x4acc('0x24')](new Uint8Array(_0x2a4f70),function(_0x54c9a4){return('00'+_0x54c9a4['toString'](0x10))['slice'](-0x2);});return _0x33e5c9['join'](',');}function isMyPrinterForName(_0x300b78){var _0x4509de=_0x300b78['toUpperCase']();var _0x54f592=_0x4509de[_0x4acc('0x1')]('-');if(_0x54f592['length']>0x1){_0x4509de=_0x54f592[_0x54f592[_0x4acc('0x18')]-0x1];if(_0x4509de[_0x4acc('0x18')]<0x8){return![];}}else{return![];}var _0x5b1299=new RegExp(_0x4acc('0x12'),'g');if(!_0x5b1299[_0x4acc('0xa')](_0x4509de)){return![];}var _0x5d0a8e=new RegExp(_0x4acc('0x11'),'g');var _0x4cf654=_0x5d0a8e['exec'](_0x4509de);var _0x5032e7='';var _0x3a068c=0x0;if(_0x4509de['charAt'](0x1)<'0'||_0x4509de[_0x4acc('0x23')](0x1)>'9'){_0x5032e7=_0x4509de[_0x4acc('0x27')](0x0,0x2);_0x4509de=_0x4509de['substring'](0x2,_0x4509de['length']);_0x3a068c+=_0x5032e7['charCodeAt'](0x0)*0xb;_0x3a068c+=_0x5032e7[_0x4acc('0xc')](0x1)*0xc;}else if(_0x4509de[_0x4acc('0x23')](0x0)<'0'||_0x4509de[_0x4acc('0x23')](0x0)>'9'){_0x5032e7=_0x4509de['substring'](0x0,0x1);_0x4509de=_0x4509de[_0x4acc('0x27')](0x1,_0x4509de[_0x4acc('0x18')]);_0x3a068c+=_0x5032e7['charCodeAt'](0x0)*0x11;}if(_0x5032e7['toUpperCase']()=='D'||_0x5032e7[_0x4acc('0x16')]()=='O'){}else if(_0x4509de[_0x4acc('0x18')]<0x8){return![];}else{if(supportPrefixKeys[_0x4acc('0x18')]>0x0){for(var _0x13e513=0x0;_0x13e513<supportPrefixKeys[_0x4acc('0x18')];_0x13e513++){var _0x45dc79=supportPrefixKeys[_0x13e513];if(_0x45dc79[_0x4acc('0x18')]>0x0){var _0x161f7a=_0x4509de[_0x4acc('0x27')](0x0,_0x45dc79['length']);if(_0x161f7a[_0x4acc('0x16')]()==_0x45dc79[_0x4acc('0x16')]()){break;}}else{return![];}}}}if(!_0x4cf654||_0x4509de['length']>=0x9||_0x4509de[_0x4acc('0x23')](0x3)!='0'){if(_0x4cf654){_0x3a068c+=(_0x4509de[_0x4acc('0x23')](0x0)-'0')*0x2;_0x3a068c+=(_0x4509de[_0x4acc('0x23')](0x1)-'0')*0x3;_0x3a068c+=(_0x4509de[_0x4acc('0x23')](0x2)-'0')*0x5;for(var _0x13e513=0x4;_0x13e513<_0x4509de['length'];++_0x13e513){_0x3a068c+=(_0x4509de[_0x4acc('0x23')](_0x13e513)-'0')*((_0x13e513&0x1)==0x0?0x7:0x9);}}else{_0x3a068c+=_0x4509de[_0x4acc('0x23')](0x0)*0x2;_0x3a068c+=_0x4509de['charAt'](0x1)*0x3;_0x3a068c+=_0x4509de['charAt'](0x2)*0x5;for(var _0x13e513=0x4;_0x13e513<_0x4509de[_0x4acc('0x18')];++_0x13e513){_0x3a068c+=_0x4509de[_0x4acc('0xc')](_0x13e513)*((_0x13e513&0x1)==0x0?0x7:0x9);}}var _0xe63d88=_0x3a068c%0xa;if(sDeTongCheckSum[_0x4acc('0x23')](_0xe63d88)!=_0x4509de[_0x4acc('0x23')](0x3)){return![];}}return!![];}