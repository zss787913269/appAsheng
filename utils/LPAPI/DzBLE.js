var _0x4c78=['0000180A-0000-1000-8000-00805F9B34FB','match','connected','substring','splice','00001801-0000-1000-8000-00805F9B34FB','characteristics','map','split','writeBLECharacteristicValue','charAt','exec','ios','charCodeAt','F000FFC0-0451-4000-B000-000000000000','services','value','^[A-Z]{0,2}[0-9]{4,5}[0-9A-Z]{2,3}[0-9]{2}$','join','openBluetoothAdapter','devices','buffer','deviceId','1F78010388','toUpperCase','uuid','toString','substr','platform','log','获取特征值失败','exports','prototype','properties','^[0-9]+','closeBLEConnection','name','1F770088','000018F0-0000-1000-8000-00805F9B34FB','getBluetoothDevices','push','length'];var _0x30f7=function(_0x4c78de,_0x30f700){_0x4c78de=_0x4c78de-0x0;var _0x5248a1=_0x4c78[_0x4c78de];return _0x5248a1;};const sDeTongCheckSum='5682904137';const maxSendDataLength=0xb4;const sendDataWaitTime=0x1c;var connectedDeviceId='';var connectedDevicServiceId='';var writeCharacteristicsId='';var readCharacteristicsId='';var notifyCharacteristicsId='';var interval=null;var printList=[];var supportPrefixKeys=[];var printHex='';var sDidSendDataHandler;var sDidSendHexHandler;module[_0x30f7('0x1f')]={'setSupportPrefixs':setSupportPrefixs,'initBLE':initBLE,'startScanPeripherals':startScanPeripherals,'stopScanPeripherals':stopScanPeripherals,'connectPeripheral':connectPeripheral,'disconnectPeripheral':disconnectPeripheral,'scanedPeripherals':scanedPeripherals,'sendData':sendData};function setSupportPrefixs(_0x40b2e7){supportPrefixKeys=_0x40b2e7;}function initBLE(_0x51900b){wx[_0x30f7('0x13')]({'success':function(_0x15dca9){console[_0x30f7('0x1d')]('初始化蓝牙适配器成功！');startScanPeripherals(_0x51900b);wx['onBluetoothAdapterStateChange'](function(_0x467f07){});}});}function startScanPeripherals(_0x3ff2e1){wx['startBluetoothDevicesDiscovery']({'success':function(_0x3962d5){setTimeout(function(){scanedPeripherals(function(_0x1f300e){_0x3ff2e1(_0x1f300e);});},0x5dc);}});}function stopScanPeripherals(){wx['stopBluetoothDevicesDiscovery']({'success':function(_0x2a6d69){}});}function connectPeripheral(_0x6f51b0,_0x252469,_0x4db3c7){wx['onBLEConnectionStateChange'](function(_0x2a193b){if(_0x2a193b[_0x30f7('0x16')]!=connectedDeviceId){return;}if(!_0x2a193b[_0x30f7('0x2')]){if(_0x4db3c7){_0x4db3c7();}}});stopScanPeripherals();wx['createBLEConnection']({'deviceId':_0x6f51b0,'success':function(_0x462272){connectedDeviceId=_0x6f51b0;wx['getBLEDeviceServices']({'deviceId':connectedDeviceId,'success':function(_0x1b38ba){var _0xb9bd44=_0x1b38ba[_0x30f7('0xf')];for(var _0x13538e=0x0;_0x13538e<_0xb9bd44['length'];_0x13538e++){var _0x2f7ba7=_0x1b38ba[_0x30f7('0xf')][_0x13538e][_0x30f7('0x19')];if(_0x2f7ba7!=_0x30f7('0xe')&&_0x2f7ba7!=_0x30f7('0x26')&&_0x2f7ba7!='00001800-0000-1000-8000-00805F9B34FB'&&_0x2f7ba7!=_0x30f7('0x0')&&_0x2f7ba7!=_0x30f7('0x5')){connectedDevicServiceId=_0x2f7ba7;break;}}wx['getBLEDeviceCharacteristics']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'success':function(_0x238754){for(var _0x4c204c=0x0;_0x4c204c<_0x238754[_0x30f7('0x6')]['length'];_0x4c204c++){if(_0x238754[_0x30f7('0x6')][_0x4c204c]['properties']['notify']){notifyCharacteristicsId=_0x238754[_0x30f7('0x6')][_0x4c204c][_0x30f7('0x19')];}if(_0x238754['characteristics'][_0x4c204c][_0x30f7('0x21')]['write']){writeCharacteristicsId=_0x238754[_0x30f7('0x6')][_0x4c204c][_0x30f7('0x19')];}if(_0x238754['characteristics'][_0x4c204c]['properties']['read']){readCharacteristicsId=_0x238754['characteristics'][_0x4c204c]['uuid'];}}wx['notifyBLECharacteristicValueChange']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':notifyCharacteristicsId,'state':!![],'success':function(_0x2f0cb3){}});wx['getSystemInfo']({'success':function(_0x26fb61){if(_0x26fb61['platform']==_0x30f7('0xc')){cheakDeviceType(!![]);}else if(_0x26fb61[_0x30f7('0x1c')]=='android'){cheakDeviceType(![]);wx['setBLEMTU']({'deviceId':connectedDeviceId,'mtu':0x200});}_0x252469();}});},'fail':function(){console['log'](_0x30f7('0x1e'));},'complete':function(){}});}});},'fail':function(_0x2a9aed){console['log']('连接蓝牙设备失败',_0x2a9aed['errCode'],_0x2a9aed['errMsg']);},'complete':function(){}});}function disconnectPeripheral(){wx[_0x30f7('0x23')]({'deviceId':connectedDeviceId,'success':function(_0x2c3560){}});}function scanedPeripherals(_0x525c3d){wx[_0x30f7('0x27')]({'success':function(_0x40f7af){var _0x390dd3=new Array();for(var _0x2a1aae=0x0;_0x2a1aae<_0x40f7af[_0x30f7('0x14')][_0x30f7('0x29')];_0x2a1aae++){var _0x545636=_0x40f7af[_0x30f7('0x14')][_0x2a1aae][_0x30f7('0x24')];if(isMyPrinterForName(_0x545636)){_0x390dd3[_0x30f7('0x28')](_0x40f7af[_0x30f7('0x14')][_0x2a1aae]);}}_0x525c3d(_0x390dd3);}});}function sendData(_0x42f689,_0x56e6a1){if(printList==null){printList=new Array();}if(_0x42f689!=null){printList['push'](_0x42f689);if(printList[_0x30f7('0x29')]>0x0){var _0x492f3d=printList[0x0];if(_0x492f3d['length']>0x0){sDidSendDataHandler=_0x56e6a1;postDatas();}else{clearInterval(interval);printList[_0x30f7('0x4')](0x0,0x1);_0x56e6a1();}}}}function postDatas(){cheakBufferSize(_0x30f7('0x25'),function(_0x37dfce){if(_0x37dfce<=0xbb8){setTimeout(()=>{postDatas();},0x32);}else{printHex='';var _0x5e34a7=printList[0x0];for(;_0x5e34a7['length']>0x0;_0x5e34a7['splice'](0x0,0x1)){var _0x1d2ed4=_0x5e34a7[0x0];if(printHex[_0x30f7('0x29')]+_0x1d2ed4['length']>=_0x37dfce){break;}printHex+=_0x1d2ed4;}postHexValue(function(){if(_0x5e34a7[_0x30f7('0x29')]>0x0){postDatas();}else{printList[_0x30f7('0x4')](0x0,0x1);sDidSendDataHandler();}});}});}function postHexValue(_0x4dd9df){sDidSendHexHandler=_0x4dd9df;postHex();}function postHex(){if(printHex['length']>0x0){interval=setTimeout(function(){var _0x40bbd3;if(printHex['length']>maxSendDataLength){_0x40bbd3=printHex[_0x30f7('0x1b')](0x0,maxSendDataLength);printHex=printHex['substring'](maxSendDataLength);}else{_0x40bbd3=printHex;printHex='';}var _0x79d891=new Uint8Array(_0x40bbd3['match'](/[\da-f]{2}/gi)['map'](function(_0x38dfe4){return parseInt(_0x38dfe4,0x10);}));wx['writeBLECharacteristicValue']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x79d891[_0x30f7('0x15')],'success':function(_0x12ad59){}});postHex();},sendDataWaitTime);}else{sDidSendHexHandler();}}function cheakDeviceType(_0x5cb1fb){var _0x1d4f4c='1F78010288';if(_0x5cb1fb){_0x1d4f4c=_0x30f7('0x17');}var _0x2180b3=new Uint8Array(_0x1d4f4c[_0x30f7('0x1')](/[\da-f]{2}/gi)['map'](function(_0x1d45a2){return parseInt(_0x1d45a2,0x10);}));wx['writeBLECharacteristicValue']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x2180b3[_0x30f7('0x15')],'success':function(_0x5e6ed6){}});}function cheakBufferSize(_0x59bb3b,_0x352373){var _0x3173ca=new Uint8Array(_0x59bb3b[_0x30f7('0x1')](/[\da-f]{2}/gi)[_0x30f7('0x7')](function(_0x21093e){return parseInt(_0x21093e,0x10);}));wx['onBLECharacteristicValueChange'](function(_0x12bc2d){if(_0x12bc2d[_0x30f7('0x16')]!=connectedDeviceId){return;}var _0x1e25ac=ab2hex(_0x12bc2d[_0x30f7('0x10')]);var _0x2bee29=0x0;var _0x22e1bd=_0x1e25ac[0x3];if(_0x22e1bd>=0xc0){var _0x1c2117=_0x1e25ac[0x3];var _0x31f40f=_0x1e25ac[0x4];_0x2bee29=(_0x1c2117<<0x8)+_0x31f40f;}else{_0x2bee29=_0x22e1bd;}_0x352373(_0x2bee29*0x1f4);});wx[_0x30f7('0x9')]({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x3173ca['buffer'],'success':function(_0x2e92ff){}});}function ab2hex(_0x47b45a){var _0x537fae=Array[_0x30f7('0x20')]['map']['call'](new Uint8Array(_0x47b45a),function(_0x37ff54){return('00'+_0x37ff54[_0x30f7('0x1a')](0x10))['slice'](-0x2);});return _0x537fae[_0x30f7('0x12')](',');}function isMyPrinterForName(_0x55e0fb){var _0x28d3a5=_0x55e0fb[_0x30f7('0x18')]();var _0x2b6012=_0x28d3a5[_0x30f7('0x8')]('-');if(_0x2b6012['length']>0x1){_0x28d3a5=_0x2b6012[_0x2b6012[_0x30f7('0x29')]-0x1];if(_0x28d3a5[_0x30f7('0x29')]<0x8){return![];}}else{return![];}var _0xbad99f=new RegExp(_0x30f7('0x11'),'g');if(!_0xbad99f['exec'](_0x28d3a5)){return![];}var _0x59140f=new RegExp(_0x30f7('0x22'),'g');var _0x5484e0=_0x59140f[_0x30f7('0xb')](_0x28d3a5);var _0x3d48b3='';var _0x346fd3=0x0;if(_0x28d3a5[_0x30f7('0xa')](0x1)<'0'||_0x28d3a5[_0x30f7('0xa')](0x1)>'9'){_0x3d48b3=_0x28d3a5[_0x30f7('0x3')](0x0,0x2);_0x28d3a5=_0x28d3a5['substring'](0x2,_0x28d3a5[_0x30f7('0x29')]);_0x346fd3+=_0x3d48b3['charCodeAt'](0x0)*0xb;_0x346fd3+=_0x3d48b3['charCodeAt'](0x1)*0xc;}else if(_0x28d3a5[_0x30f7('0xa')](0x0)<'0'||_0x28d3a5['charAt'](0x0)>'9'){_0x3d48b3=_0x28d3a5['substring'](0x0,0x1);_0x28d3a5=_0x28d3a5['substring'](0x1,_0x28d3a5['length']);_0x346fd3+=_0x3d48b3[_0x30f7('0xd')](0x0)*0x11;}if(_0x3d48b3['toUpperCase']()=='D'||_0x3d48b3['toUpperCase']()=='O'){}else if(_0x28d3a5[_0x30f7('0x29')]<0x8){return![];}else{if(supportPrefixKeys['length']>0x0){for(var _0x47392e=0x0;_0x47392e<supportPrefixKeys['length'];_0x47392e++){var _0x10c8be=supportPrefixKeys[_0x47392e];if(_0x10c8be['length']>0x0){var _0x51a667=_0x28d3a5['substring'](0x0,_0x10c8be['length']);if(_0x51a667['toUpperCase']()==_0x10c8be[_0x30f7('0x18')]()){break;}}else{return![];}}}}if(!_0x5484e0||_0x28d3a5['length']>=0x9||_0x28d3a5['charAt'](0x3)!='0'){if(_0x5484e0){_0x346fd3+=(_0x28d3a5[_0x30f7('0xa')](0x0)-'0')*0x2;_0x346fd3+=(_0x28d3a5[_0x30f7('0xa')](0x1)-'0')*0x3;_0x346fd3+=(_0x28d3a5[_0x30f7('0xa')](0x2)-'0')*0x5;for(var _0x47392e=0x4;_0x47392e<_0x28d3a5[_0x30f7('0x29')];++_0x47392e){_0x346fd3+=(_0x28d3a5['charAt'](_0x47392e)-'0')*((_0x47392e&0x1)==0x0?0x7:0x9);}}else{_0x346fd3+=_0x28d3a5[_0x30f7('0xa')](0x0)*0x2;_0x346fd3+=_0x28d3a5['charAt'](0x1)*0x3;_0x346fd3+=_0x28d3a5['charAt'](0x2)*0x5;for(var _0x47392e=0x4;_0x47392e<_0x28d3a5['length'];++_0x47392e){_0x346fd3+=_0x28d3a5[_0x30f7('0xd')](_0x47392e)*((_0x47392e&0x1)==0x0?0x7:0x9);}}var _0x2b7961=_0x346fd3%0xa;if(sDeTongCheckSum[_0x30f7('0xa')](_0x2b7961)!=_0x28d3a5[_0x30f7('0xa')](0x3)){return![];}}return!![];}