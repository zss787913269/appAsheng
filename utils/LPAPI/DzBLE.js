var _0x3792=['call','charAt','push','slice','showToast','F000FFC0-0451-4000-B000-000000000000','charCodeAt','toUpperCase','00001801-0000-1000-8000-00805F9B34FB','getBLEDeviceServices','prototype','notify','0000180A-0000-1000-8000-00805F9B34FB','connected','000018F0-0000-1000-8000-00805F9B34FB','连接打印机失败','substr','openBluetoothAdapter','uuid','exec','buffer','name','1F770088','^[A-Z]{0,2}[0-9]{4,5}[0-9A-Z]{2,3}[0-9]{2}$','setBLEMTU','devices','log','getBLEDeviceCharacteristics','services','初始化蓝牙适配器成功！','连接蓝牙设备失败','match','writeBLECharacteristicValue','substring','获取特征值失败','length','characteristics','onBluetoothAdapterStateChange','startBluetoothDevicesDiscovery','loading','splice','properties','createBLEConnection','^[0-9]+','join'];var _0x4f02=function(_0x379290,_0x4f0278){_0x379290=_0x379290-0x0;var _0x4fd77a=_0x3792[_0x379290];return _0x4fd77a;};const sDeTongCheckSum='5682904137';const maxSendDataLength=0xb4;const sendDataWaitTime=0x1c;var connectedDeviceId='';var connectedDevicServiceId='';var writeCharacteristicsId='';var readCharacteristicsId='';var notifyCharacteristicsId='';var interval=null;var printList=[];var supportPrefixKeys=[];var printHex='';var sDidSendDataHandler;var sDidSendHexHandler;module['exports']={'setSupportPrefixs':setSupportPrefixs,'initBLE':initBLE,'startScanPeripherals':startScanPeripherals,'stopScanPeripherals':stopScanPeripherals,'connectPeripheral':connectPeripheral,'disconnectPeripheral':disconnectPeripheral,'scanedPeripherals':scanedPeripherals,'sendData':sendData};function setSupportPrefixs(_0x71bad2){supportPrefixKeys=_0x71bad2;}function initBLE(_0x1e22df){wx[_0x4f02('0x11')]({'success':function(_0x1498bc){console['log'](_0x4f02('0x1d'));startScanPeripherals(_0x1e22df);wx[_0x4f02('0x25')](function(_0x38723f){});}});}function startScanPeripherals(_0x371741){wx[_0x4f02('0x26')]({'success':function(_0x55b779){setTimeout(function(){scanedPeripherals(function(_0x53de0e){_0x371741(_0x53de0e);});},0x5dc);}});}function stopScanPeripherals(){wx['stopBluetoothDevicesDiscovery']({'success':function(_0x15b039){}});}function connectPeripheral(_0x3c7e19,_0x12ace7,_0x25e7a7){stopScanPeripherals();wx['onBLEConnectionStateChange'](function(_0x3fcddb){if(!_0x3fcddb[_0x4f02('0xd')]){_0x25e7a7();}});wx[_0x4f02('0x2a')]({'deviceId':_0x3c7e19,'success':function(_0x1e39ff){connectedDeviceId=_0x3c7e19;wx[_0x4f02('0x9')]({'deviceId':connectedDeviceId,'success':function(_0x275fd6){var _0x11afd8=_0x275fd6['services'];for(var _0x57d755=0x0;_0x57d755<_0x11afd8['length'];_0x57d755++){var _0x58f7ce=_0x275fd6[_0x4f02('0x1c')][_0x57d755]['uuid'];if(_0x58f7ce!=_0x4f02('0x5')&&_0x58f7ce!=_0x4f02('0xe')&&_0x58f7ce!='00001800-0000-1000-8000-00805F9B34FB'&&_0x58f7ce!=_0x4f02('0xc')&&_0x58f7ce!=_0x4f02('0x8')){connectedDevicServiceId=_0x58f7ce;break;}}wx[_0x4f02('0x1b')]({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'success':function(_0x44f5ee){for(var _0x47a9fb=0x0;_0x47a9fb<_0x44f5ee['characteristics'][_0x4f02('0x23')];_0x47a9fb++){if(_0x44f5ee[_0x4f02('0x24')][_0x47a9fb][_0x4f02('0x29')][_0x4f02('0xb')]){notifyCharacteristicsId=_0x44f5ee[_0x4f02('0x24')][_0x47a9fb][_0x4f02('0x12')];}if(_0x44f5ee['characteristics'][_0x47a9fb]['properties']['write']){writeCharacteristicsId=_0x44f5ee[_0x4f02('0x24')][_0x47a9fb][_0x4f02('0x12')];}if(_0x44f5ee[_0x4f02('0x24')][_0x47a9fb][_0x4f02('0x29')]['read']){readCharacteristicsId=_0x44f5ee[_0x4f02('0x24')][_0x47a9fb][_0x4f02('0x12')];}}wx['notifyBLECharacteristicValueChange']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':notifyCharacteristicsId,'state':!![],'success':function(_0x3053f4){}});wx[_0x4f02('0x18')]({'deviceId':connectedDeviceId,'mtu':0x200});_0x12ace7();},'fail':function(){console[_0x4f02('0x1a')](_0x4f02('0x22'));},'complete':function(){}});}});},'fail':function(_0x2dc04f){console[_0x4f02('0x1a')](_0x4f02('0x1e'),_0x2dc04f['errCode'],_0x2dc04f['errMsg']);wx[_0x4f02('0x4')]({'title':_0x4f02('0xf'),'icon':'','image':'','duration':0x7d0,'mask':!![],'success':function(_0xd9e197){},'fail':function(_0x2f3a00){},'complete':function(_0x45ab65){}});},'complete':function(){}});}function disconnectPeripheral(){wx['closeBLEConnection']({'deviceId':connectedDeviceId,'success':function(_0x198935){}});}function scanedPeripherals(_0xa9f8a8){wx['getBluetoothDevices']({'success':function(_0xff4234){var _0x4f9459=new Array();for(var _0xb87dd5=0x0;_0xb87dd5<_0xff4234[_0x4f02('0x19')][_0x4f02('0x23')];_0xb87dd5++){var _0x36ee8b=_0xff4234['devices'][_0xb87dd5][_0x4f02('0x15')];if(isMyPrinterForName(_0x36ee8b)){_0x4f9459[_0x4f02('0x2')](_0xff4234[_0x4f02('0x19')][_0xb87dd5]);}}_0xa9f8a8(_0x4f9459);}});}function sendData(_0x193bc0,_0x582c66){if(printList==null){printList=new Array();}if(_0x193bc0!=null){printList[_0x4f02('0x2')](_0x193bc0);if(printList[_0x4f02('0x23')]>0x0){var _0x28a3f4=printList[0x0];if(_0x28a3f4['length']>0x0){wx[_0x4f02('0x4')]({'title':'正在发送数据','icon':_0x4f02('0x27'),'image':'','duration':0x2710,'mask':!![],'success':function(_0x20e606){},'fail':function(_0x111d16){},'complete':function(_0x56678c){}});sDidSendDataHandler=_0x582c66;postDatas();}else{clearInterval(interval);printList['splice'](0x0,0x1);wx['hideToast']();_0x582c66();}}}}function postDatas(){cheakBufferSize(_0x4f02('0x16'),function(_0x3e6698){printHex='';var _0xb9e2=printList[0x0];for(;_0xb9e2['length']>0x0;_0xb9e2['splice'](0x0,0x1)){var _0x36ebea=_0xb9e2[0x0];if(printHex['length']+_0x36ebea[_0x4f02('0x23')]>=_0x3e6698){break;}printHex+=_0x36ebea;}postHexValue(function(){if(_0xb9e2['length']>0x0){postDatas();}else{printList[_0x4f02('0x28')](0x0,0x1);wx['hideToast']();sDidSendDataHandler();}});});}function postHexValue(_0x461e5c){sDidSendHexHandler=_0x461e5c;postHex();}function postHex(){if(printHex[_0x4f02('0x23')]>0x0){interval=setTimeout(function(){var _0x5018c4;if(printHex['length']>maxSendDataLength){_0x5018c4=printHex[_0x4f02('0x10')](0x0,maxSendDataLength);printHex=printHex[_0x4f02('0x21')](maxSendDataLength);}else{_0x5018c4=printHex;printHex='';}var _0x443382=new Uint8Array(_0x5018c4[_0x4f02('0x1f')](/[\da-f]{2}/gi)['map'](function(_0x5bf663){return parseInt(_0x5bf663,0x10);}));wx[_0x4f02('0x20')]({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x443382['buffer'],'success':function(_0x2bee1b){}});postHex();},sendDataWaitTime);}else{sDidSendHexHandler();}}function cheakBufferSize(_0x219636,_0x1498bf){var _0x4a2cd5=new Uint8Array(_0x219636['match'](/[\da-f]{2}/gi)['map'](function(_0x349246){return parseInt(_0x349246,0x10);}));wx['onBLECharacteristicValueChange'](function(_0x2c1708){var _0x3672be=_0x4a66a0(_0x2c1708['value']);var _0x1e4be4=0x0;var _0x276c30=_0x3672be[0x3];if(_0x276c30>=0xc0){var _0x306f71=_0x3672be[0x3];var _0x282f71=_0x3672be[0x4];_0x1e4be4=(_0x306f71<<0x8)+_0x282f71;}else{_0x1e4be4=_0x276c30;}_0x1498bf(_0x1e4be4*0x1f4);});function _0x4a66a0(_0x51dadf){var _0x233e7d=Array[_0x4f02('0xa')]['map'][_0x4f02('0x0')](new Uint8Array(_0x51dadf),function(_0x21a9d7){return('00'+_0x21a9d7['toString'](0x10))[_0x4f02('0x3')](-0x2);});return _0x233e7d[_0x4f02('0x2c')](',');}wx[_0x4f02('0x20')]({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x4a2cd5[_0x4f02('0x14')],'success':function(_0x4b867e){}});}function isMyPrinterForName(_0x759cb0){var _0x6dc14d=_0x759cb0['toUpperCase']();var _0xb84c7c=_0x6dc14d['split']('-');if(_0xb84c7c['length']>0x1){_0x6dc14d=_0xb84c7c[_0xb84c7c['length']-0x1];if(_0x6dc14d[_0x4f02('0x23')]<0x8){return![];}}else{return![];}var _0x3287b4=new RegExp(_0x4f02('0x17'),'g');if(!_0x3287b4['exec'](_0x6dc14d)){return![];}var _0x775ddf=new RegExp(_0x4f02('0x2b'),'g');var _0x50cd0f=_0x775ddf[_0x4f02('0x13')](_0x6dc14d);var _0xecde72='';var _0x141fae=0x0;if(_0x6dc14d[_0x4f02('0x1')](0x1)<'0'||_0x6dc14d[_0x4f02('0x1')](0x1)>'9'){_0xecde72=_0x6dc14d['substring'](0x0,0x2);_0x6dc14d=_0x6dc14d['substring'](0x2,_0x6dc14d['length']);_0x141fae+=_0xecde72[_0x4f02('0x6')](0x0)*0xb;_0x141fae+=_0xecde72[_0x4f02('0x6')](0x1)*0xc;}else if(_0x6dc14d[_0x4f02('0x1')](0x0)<'0'||_0x6dc14d['charAt'](0x0)>'9'){_0xecde72=_0x6dc14d[_0x4f02('0x21')](0x0,0x1);_0x6dc14d=_0x6dc14d['substring'](0x1,_0x6dc14d['length']);_0x141fae+=_0xecde72[_0x4f02('0x6')](0x0)*0x11;}if(_0xecde72[_0x4f02('0x7')]()=='D'||_0xecde72[_0x4f02('0x7')]()=='O'){}else if(_0x6dc14d[_0x4f02('0x23')]<0x8){return![];}else{if(supportPrefixKeys[_0x4f02('0x23')]>0x0){for(var _0x4c22b8=0x0;_0x4c22b8<supportPrefixKeys['length'];_0x4c22b8++){var _0x47ba35=supportPrefixKeys[_0x4c22b8];if(_0x47ba35[_0x4f02('0x23')]>0x0){var _0x1bec4e=_0x6dc14d['substring'](0x0,_0x47ba35[_0x4f02('0x23')]);if(_0x1bec4e['toUpperCase']()==_0x47ba35['toUpperCase']()){break;}}else{return![];}}}}if(!_0x50cd0f||_0x6dc14d[_0x4f02('0x23')]>=0x9||_0x6dc14d['charAt'](0x3)!='0'){if(_0x50cd0f){_0x141fae+=(_0x6dc14d[_0x4f02('0x1')](0x0)-'0')*0x2;_0x141fae+=(_0x6dc14d['charAt'](0x1)-'0')*0x3;_0x141fae+=(_0x6dc14d[_0x4f02('0x1')](0x2)-'0')*0x5;for(var _0x4c22b8=0x4;_0x4c22b8<_0x6dc14d[_0x4f02('0x23')];++_0x4c22b8){_0x141fae+=(_0x6dc14d[_0x4f02('0x1')](_0x4c22b8)-'0')*((_0x4c22b8&0x1)==0x0?0x7:0x9);}}else{_0x141fae+=_0x6dc14d[_0x4f02('0x1')](0x0)*0x2;_0x141fae+=_0x6dc14d['charAt'](0x1)*0x3;_0x141fae+=_0x6dc14d['charAt'](0x2)*0x5;for(var _0x4c22b8=0x4;_0x4c22b8<_0x6dc14d[_0x4f02('0x23')];++_0x4c22b8){_0x141fae+=_0x6dc14d['charCodeAt'](_0x4c22b8)*((_0x4c22b8&0x1)==0x0?0x7:0x9);}}var _0x381486=_0x141fae%0xa;if(sDeTongCheckSum['charAt'](_0x381486)!=_0x6dc14d['charAt'](0x3)){return![];}}return!![];}